var k=Object.defineProperty;var q=(r,t,n)=>t in r?k(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n;var S=(r,t,n)=>(q(r,typeof t!="symbol"?t+"":t,n),n);import{t as v,j as u,a as e,w as A,x as I,e as w,h as P,c as B,d as x,B as D,y as W,g as j,b as g,G as T,T as C,o as E,S as L,r as M,s as z,z as G}from"./index-120fe44f.js";import{G as O,I as N,u as $,o as H,T as R,C as b,a as _,b as U,c as J}from"./TemplateTextField-5f56fdde.js";const Q=({label:r,colSpan:t,placeholder:n,field:m,floatingLabel:p=!1,fieldState:h,...y})=>{var c;const l=v.useId();return u(O,{colSpan:t,children:[p?null:e(A,{htmlFor:l,sx:N,error:!!h.error,children:r}),e(I,{...m,id:l,fullWidth:!0,placeholder:n,type:"number",label:p?r:void 0,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},error:!!h.error,helperText:((c=h.error)==null?void 0:c.message)??"",...y})]})};class V{constructor(){S(this,"keys",{list:()=>["orders","list"]});S(this,"create",async t=>{const{data:n}=await P.post("app/orders",t);return n})}}const Y=new V,K=()=>w({mutationFn:r=>Y.create(r)}),X=B().shape({first_name:x().required("El nombre es obligatorio"),last_name:x().required("El apellido es obligatorio"),email:x().email("Email inválido").required("El email es obligatorio"),phone:x().required("El teléfono es obligatorio").matches(/^[0-9+\-\s()]+$/,"Solo números, espacios, + y guiones").min(10,"Mínimo 10 caracteres"),delivery_method:x().oneOf(["pickup","delivery"]).required("Debe seleccionar un método de entrega"),address:x().when("delivery_method",{is:"delivery",then:r=>r.required("La dirección es obligatoria para envío a domicilio"),otherwise:r=>r.optional().default("")})}),Z=({cart:r,totalAmount:t,shippingCost:n,isHomeDelivery:m,onSuccess:p,onCancel:h})=>{const y=$({resolver:H(X),defaultValues:{first_name:"",last_name:"",email:"",phone:"",address:"",delivery_method:m?"delivery":"pickup"}}),{control:l,formState:c}=y,f=K();return u(R,{hf:y,onSubmit:async a=>{var o,d;const s={customer:{first_name:a.first_name,last_name:a.last_name,email:a.email,phone:a.phone,address:a.delivery_method==="delivery"?a.address:null},total_amount:t,shipping_cost:n,is_home_delivery:a.delivery_method==="delivery",items:r.map(i=>({product_id:i.product.id,product_name:i.product.name,quantity:i.quantity,unit_price:i.product.original_price,subtotal:i.product.original_price*i.quantity}))};try{const i=await f.mutateAsync(s);p(i)}catch(i){console.error("Error al crear orden:",i),alert(((d=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:d.message)||"Error al procesar la compra")}},children:[e(b,{name:"first_name",control:l,render:({field:a,fieldState:s})=>e(_,{field:a,fieldState:s,formState:c,label:"Nombre",placeholder:"Juan"})}),e(b,{name:"last_name",control:l,render:({field:a,fieldState:s})=>e(_,{field:a,fieldState:s,formState:c,label:"Apellido",placeholder:"Pérez"})}),e(b,{name:"email",control:l,render:({field:a,fieldState:s})=>e(_,{field:a,fieldState:s,formState:c,label:"Email",placeholder:"correo@ejemplo.com"})}),e(b,{name:"phone",control:l,render:({field:a,fieldState:s})=>e(Q,{field:a,fieldState:s,formState:c,label:"Teléfono",placeholder:"11 1234-5678"})}),m&&e(b,{name:"address",control:l,render:({field:a,fieldState:s})=>e(_,{field:{...a,value:a.value??"",onChange:o=>a.onChange(o.target.value)},fieldState:s,formState:c,label:"Dirección de envío",placeholder:"Av. Corrientes 1234, Piso 5, Dto A",multiline:!0})}),u(U,{children:[e(D,{onClick:h,variant:"outlined",color:"inherit",children:"Cancelar"}),e(J,{children:"Confirmar Compra"})]})]})},oe=()=>{const{cart:r,removeFromCart:t}=W(),[n,m]=v.useState(!1),[p,h]=v.useState(!1),{enqueueSnackbar:y}=j(),l=r.reduce((o,d)=>o+d.product.original_price*d.quantity,0),[c,f]=v.useState(l),[F,a]=v.useState(0),s=o=>{y({message:"¡Compra confirmada!",variant:"success"}),r.forEach(d=>t(d.product.id)),m(!1)};return e(g,{sx:{padding:3,maxWidth:1200,margin:"0 auto"},children:u(T,{container:!0,spacing:3,children:[u(T,{item:!0,xs:12,md:8,children:[e(g,{sx:{display:"flex",alignItems:"center",mb:2},children:e(C,{variant:"h6",sx:{ml:1},children:"Carrito"})}),r.length===0?e(C,{children:"El carrito está vacío."}):r.map(o=>u(E,{sx:{mb:2,p:2},children:[e(g,{sx:{display:{xs:"block",md:"none"}},children:e(L,{item:o})}),u(g,{sx:{display:{xs:"none",md:"flex"},alignItems:"center",gap:2},children:[e("img",{src:o.product.images[0].image_url,alt:o.product.name,style:{width:80,height:80,objectFit:"cover",borderRadius:10}}),u(g,{sx:{flex:1},children:[e(C,{variant:"body1",sx:{fontWeight:500,mb:1,textTransform:"none"},children:o.product.name}),e(C,{color:"error",variant:"body2",sx:{cursor:"pointer"},onClick:()=>t(o.product.id),children:"Eliminar"})]}),e(g,{sx:{textAlign:"center",minWidth:120},children:e(C,{variant:"h6",sx:{fontWeight:"bold"},children:M(o.product.original_price)})}),e(g,{sx:{display:"flex",alignItems:"center",gap:1},children:e(z,{product:o.product,quantity:o.quantity,size:"small",sx:{bgcolor:"grey.200","&:hover":{bgcolor:"grey.300"}}})})]})]},o.product.id))]}),e(T,{item:!0,xs:12,md:4,children:e(G,{cartProducts:r,totalAmount:l,showCheckoutForm:n,onCheckout:()=>m(!0),isHomeDelivery:p,onIsHomeDeliveryChange:h,onTotalChange:(o,d)=>{f(o),a(d)}})}),n&&u(E,{sx:{mt:3,p:3,maxWidth:"sm"},children:[e(C,{variant:"h6",gutterBottom:!0,children:"Completa tus datos para finalizar la compra"}),e(Z,{cart:r,totalAmount:c,shippingCost:F,isHomeDelivery:p,onSuccess:s,onCancel:()=>m(!1)})]})]})})};export{oe as default};

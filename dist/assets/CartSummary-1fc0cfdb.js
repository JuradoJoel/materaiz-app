var oe=Object.defineProperty;var re=(e,o,n)=>o in e?oe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var H=(e,o,n)=>(re(e,typeof o!="symbol"?o+"":o,n),n);import{y as L,j as t,i as T,aR as ne,aS as se,_ as g,b as ae,aT as le,e as ie,f as ce,s as F,z as de,x as U,aU as V,aV as Z,r as z,h as pe,I as ue,m as l,k as ge,l as he,ah as ve,U as u,T as a,aw as fe,ax as me,N as ye,Z as D,aW as q,aX as j,aY as B,$ as X,aZ as xe,X as Ce,J as Se}from"./index-5ef99565.js";import{G as _,c as be,f as k,C as J,b as Q}from"./CartQuantityControl-7bbff748.js";import{T as we}from"./TextField-7aae9f4a.js";const Pe=L(t("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Ae=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],Ie=["component","slots","slotProps"],$e=["component"];function Y(e,o){const{className:n,elementType:r,ownerState:d,externalForwardedProps:S,getSlotOwnerState:v,internalForwardedProps:A}=o,b=T(o,Ae),{component:I,slots:p={[e]:void 0},slotProps:$={[e]:void 0}}=S,w=T(S,Ie),h=p[e]||r,P=ne($[e],d),c=se(g({className:n},b,{externalForwardedProps:e==="root"?w:void 0,externalSlotProps:P})),{props:{component:f},internalRef:m}=c,y=T(c.props,$e),x=ae(m,P==null?void 0:P.ref,o.ref),i=v?v(y):{},C=g({},d,i),M=e==="root"?f||I:f,E=le(h,g({},e==="root"&&!I&&!p[e]&&A,e!=="root"&&!p[e]&&A,y,M&&{as:M},{ref:x}),C);return Object.keys(i).forEach(R=>{delete E[R]}),[h,E]}function Me(e){return ce("MuiAlert",e)}const Ee=ie("MuiAlert",["root","action","icon","message","filled","colorSuccess","colorInfo","colorWarning","colorError","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]),K=Ee,ze=L(t("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"}),"SuccessOutlined"),Re=L(t("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),"ReportProblemOutlined"),Oe=L(t("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),We=L(t("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),"InfoOutlined"),ke=["action","children","className","closeText","color","components","componentsProps","icon","iconMapping","onClose","role","severity","slotProps","slots","variant"],Le=e=>{const{variant:o,color:n,severity:r,classes:d}=e,S={root:["root",`color${U(n||r)}`,`${o}${U(n||r)}`,`${o}`],icon:["icon"],message:["message"],action:["action"]};return he(S,Me,d)},Te=F(de,{name:"MuiAlert",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:n}=e;return[o.root,o[n.variant],o[`${n.variant}${U(n.color||n.severity)}`]]}})(({theme:e})=>{const o=e.palette.mode==="light"?V:Z,n=e.palette.mode==="light"?Z:V;return g({},e.typography.body2,{backgroundColor:"transparent",display:"flex",padding:"6px 16px",variants:[...Object.entries(e.palette).filter(([,r])=>r.main&&r.light).map(([r])=>({props:{colorSeverity:r,variant:"standard"},style:{color:e.vars?e.vars.palette.Alert[`${r}Color`]:o(e.palette[r].light,.6),backgroundColor:e.vars?e.vars.palette.Alert[`${r}StandardBg`]:n(e.palette[r].light,.9),[`& .${K.icon}`]:e.vars?{color:e.vars.palette.Alert[`${r}IconColor`]}:{color:e.palette[r].main}}})),...Object.entries(e.palette).filter(([,r])=>r.main&&r.light).map(([r])=>({props:{colorSeverity:r,variant:"outlined"},style:{color:e.vars?e.vars.palette.Alert[`${r}Color`]:o(e.palette[r].light,.6),border:`1px solid ${(e.vars||e).palette[r].light}`,[`& .${K.icon}`]:e.vars?{color:e.vars.palette.Alert[`${r}IconColor`]}:{color:e.palette[r].main}}})),...Object.entries(e.palette).filter(([,r])=>r.main&&r.dark).map(([r])=>({props:{colorSeverity:r,variant:"filled"},style:g({fontWeight:e.typography.fontWeightMedium},e.vars?{color:e.vars.palette.Alert[`${r}FilledColor`],backgroundColor:e.vars.palette.Alert[`${r}FilledBg`]}:{backgroundColor:e.palette.mode==="dark"?e.palette[r].dark:e.palette[r].main,color:e.palette.getContrastText(e.palette[r].main)})}))]})}),Fe=F("div",{name:"MuiAlert",slot:"Icon",overridesResolver:(e,o)=>o.icon})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),Ne=F("div",{name:"MuiAlert",slot:"Message",overridesResolver:(e,o)=>o.message})({padding:"8px 0",minWidth:0,overflow:"auto"}),ee=F("div",{name:"MuiAlert",slot:"Action",overridesResolver:(e,o)=>o.action})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),te={success:t(ze,{fontSize:"inherit"}),warning:t(Re,{fontSize:"inherit"}),error:t(Oe,{fontSize:"inherit"}),info:t(We,{fontSize:"inherit"})},je=z.forwardRef(function(o,n){const r=pe({props:o,name:"MuiAlert"}),{action:d,children:S,className:v,closeText:A="Close",color:b,components:I={},componentsProps:p={},icon:$,iconMapping:w=te,onClose:h,role:P="alert",severity:c="success",slotProps:f={},slots:m={},variant:y="standard"}=r,x=T(r,ke),i=g({},r,{color:b,severity:c,variant:y,colorSeverity:b||c}),C=Le(i),M={slots:g({closeButton:I.CloseButton,closeIcon:I.CloseIcon},m),slotProps:g({},p,f)},[E,R]=Y("closeButton",{elementType:ue,externalForwardedProps:M,ownerState:i}),[O,N]=Y("closeIcon",{elementType:Pe,externalForwardedProps:M,ownerState:i});return l(Te,g({role:P,elevation:0,ownerState:i,className:ge(C.root,v),ref:n},x,{children:[$!==!1?t(Fe,{ownerState:i,className:C.icon,children:$||w[c]||te[c]}):null,t(Ne,{ownerState:i,className:C.message,children:S}),d!=null?t(ee,{ownerState:i,className:C.action,children:d}):null,d==null&&h?t(ee,{ownerState:i,className:C.action,children:t(E,g({size:"small","aria-label":A,title:A,color:"inherit",onClick:h},R,{children:t(O,g({fontSize:"small"},N))}))}):null]}))}),Be=je,qe=({item:e,compact:o=!1})=>{const{removeFromCart:n}=ve();return t(u,{sx:{px:o?1.5:0,py:o?.5:0},children:l(_,{container:!0,spacing:2,alignItems:"center",children:[t(_,{item:!0,xs:3,sm:2,md:1.5,lg:o?2.5:1.5,children:t("img",{src:e.product.images[0].image_url,alt:e.product.name,style:{width:"100%",maxWidth:80,maxHeight:80,aspectRatio:1,objectFit:"cover",borderRadius:10}})}),l(_,{item:!0,xs:9,sm:o?9.5:10,md:o?10:10.5,lg:o?9.5:10.5,children:[t(a,{variant:"body2",sx:{fontWeight:500,mb:1,textTransform:"none",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.product.name}),t(a,{color:"error",variant:"body2",sx:{cursor:"pointer",mb:1},onClick:()=>e.product.id&&n(e.product.id),children:"Eliminar"}),l(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t(u,{sx:{display:"flex",alignItems:"center",gap:1},children:t(be,{product:e.product,quantity:e.quantity,size:"small",sx:{bgcolor:"grey.200","&:hover":{bgcolor:"grey.300"}}})}),t(a,{variant:"h6",sx:{fontWeight:"bold"},children:k(e.product.original_price)})]})]})]})})};class _e{constructor(){H(this,"calculate",async o=>{const{data:n}=await me.post("/app/shipping/calculate",o);if(!n.success)throw new Error(n.message||"Error al calcular envío");return n.data.options})}}const Ue=new _e,Ge=()=>fe({mutationFn:Ue.calculate,onSuccess:()=>{console.log("Costo de envío calculado correctamente")},onError:e=>{console.error("Error al calcular el costo de envío:",e)}});function Xe({cartProducts:e,totalAmount:o,totalWeight:n=.5,fromNav:r,onCheckout:d,showCheckoutForm:S,isHomeDelivery:v,onIsHomeDeliveryChange:A,onTotalChange:b}){var G;const I=ye(),[p,$]=z.useState(""),[w,h]=z.useState([]),[P,c]=z.useState(""),[f,m]=z.useState(""),y=Ge(),x=v&&((G=w.find(s=>`${s.deliveryType}-${s.service}`===P))==null?void 0:G.cost)||0,i=o+x;z.useEffect(()=>{b==null||b(i,x)},[i,x]);const C=s=>{A(s),s||($(""),h([]),c(""),m(""),y.reset())},M=s=>{const W=s.target.value.replace(/\D/g,"").slice(0,8);$(W),m(""),W.length===0&&(h([]),c(""))},E=()=>{if(p.length<4){m("El código postal debe tener al menos 4 dígitos");return}m(""),y.mutate({destCP:p,weight:n,dimensions:{length:20,width:15,height:10}},{onSuccess:s=>{if(h(s),s.length>0){const W=s[0];c(`${W.deliveryType}-${W.service}`)}},onError:()=>{m("No se pudo calcular el envío"),h([]),c("")}})},R=()=>{r?I(Se.cart.root):d==null||d()},O=y.isPending,N=y.isError;return e.length===0?t(J,{sx:{position:"sticky",top:20},children:l(Q,{children:[t(a,{variant:"h6",children:"Resumen de compra"}),t(a,{color:"text.secondary",sx:{mt:1},children:"No hay productos en el carrito."})]})}):t(J,{sx:{position:"sticky",top:20},children:l(Q,{children:[t(a,{variant:"h6",sx:{mb:2},children:"Resumen de compra"}),l(u,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[l(a,{children:["Productos (",e.length,")"]}),t(a,{children:k(o)})]}),t(D,{sx:{my:2}}),l(u,{sx:{mb:2},children:[t(a,{sx:{mb:1,fontWeight:500},children:"Método de entrega:"}),l(q,{name:"homeDelivery",value:v?"delivery":"pickup",onChange:s=>C(s.target.value==="delivery"),children:[t(j,{value:"pickup",control:t(B,{}),label:"Retiro por local (Gratis)"}),t(j,{value:"delivery",control:t(B,{}),label:"Envío a domicilio"})]})]}),v&&l(u,{sx:{mb:2,pl:4},children:[t(a,{sx:{mb:1,fontSize:"0.875rem",fontWeight:500},children:"Calculá tu envío:"}),l(u,{sx:{display:"flex",gap:1,mb:2},children:[t(we,{size:"small",placeholder:"Código Postal",value:p,onChange:M,inputProps:{maxLength:8},sx:{flex:1},error:!!f}),t(X,{variant:"outlined",onClick:E,disabled:O||p.length<4,sx:{minWidth:"100px"},children:O?t(xe,{size:20}):"Calcular"})]}),(f||N)&&t(Be,{severity:"error",sx:{mb:2},children:f||"Error al conectar con el servidor"}),w.length>0&&l(Ce,{children:[t(a,{sx:{mb:1,fontSize:"0.875rem",color:"text.secondary"},children:"Opciones de envío disponibles:"}),t(q,{value:P,onChange:s=>c(s.target.value),children:w.map(s=>t(j,{value:`${s.deliveryType}-${s.service}`,control:t(B,{}),label:l(u,{children:[t(a,{variant:"body2",children:s.service}),l(a,{variant:"caption",color:"text.secondary",children:[k(s.cost)," - Llega en ",s.estimatedDays," días"]})]})},`${s.deliveryType}-${s.service}`))})]}),w.length===0&&!O&&p.length>=4&&!f&&t(a,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:"No hay opciones disponibles para este código postal"})]}),v?l(u,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[t(a,{children:"Envío"}),t(a,{children:x>0?k(x):"—"})]}):l(u,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[t(a,{children:"Envío"}),t(a,{color:"success.main",sx:{fontWeight:500},children:"Gratis"})]}),t(D,{sx:{my:2}}),l(u,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[t(a,{variant:"h6",children:"Total"}),t(a,{variant:"h6",sx:{fontWeight:"bold"},children:k(i)})]}),!S&&t(X,{variant:"contained",color:"primary",fullWidth:!0,size:"large",onClick:R,sx:{py:1.5,fontSize:"1rem",fontWeight:"bold"},children:"Continuar compra"})]})})}export{Pe as C,qe as S,Xe as a,Y as u};

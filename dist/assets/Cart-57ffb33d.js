var q=Object.defineProperty;var I=(r,a,n)=>a in r?q(r,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[a]=n;var S=(r,a,n)=>(I(r,typeof a!="symbol"?a+"":a,n),n);import{r as b,m as u,j as e,aw as P,ax as w,au as D,av as C,$ as W,ah as j,ay as B,U as g,T as x}from"./index-9953c07a.js";import{A as L,S as M,a as G}from"./CartSummary-432115c5.js";import{G as F,C as k,f as O,c as $}from"./CartQuantityControl-23b0c5c1.js";import{G as z,I as N,u as R,o as U,T as H,C as v,a as _,b as J,c as Q}from"./TemplateTextField-3acdfabf.js";import{c as V,T as Y}from"./TextField-b38cddfb.js";const K=({label:r,colSpan:a,placeholder:n,field:c,floatingLabel:p=!1,fieldState:h,...y})=>{var l;const d=b.useId();return u(z,{colSpan:a,children:[p?null:e(V,{htmlFor:d,sx:N,error:!!h.error,children:r}),e(Y,{...c,id:d,fullWidth:!0,placeholder:n,type:"number",label:p?r:void 0,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},error:!!h.error,helperText:((l=h.error)==null?void 0:l.message)??"",...y})]})};class X{constructor(){S(this,"keys",{list:()=>["orders","list"]});S(this,"create",async a=>{const{data:n}=await w.post("app/orders",a);return n})}}const Z=new X,ee=()=>P({mutationFn:r=>Z.create(r)}),re=D().shape({first_name:C().required("El nombre es obligatorio"),last_name:C().required("El apellido es obligatorio"),email:C().email("Email inválido").required("El email es obligatorio"),phone:C().required("El teléfono es obligatorio").matches(/^[0-9+\-\s()]+$/,"Solo números, espacios, + y guiones").min(10,"Mínimo 10 caracteres"),delivery_method:C().oneOf(["freight","delivery"]).required("Debe seleccionar un método de entrega"),address:C().when("delivery_method",{is:"delivery",then:r=>r.required("La dirección es obligatoria para envío a domicilio"),otherwise:r=>r.optional().default("")})}),oe=({cart:r,totalAmount:a,shippingCost:n,isHomeDelivery:c,onSuccess:p,onCancel:h})=>{const y=R({resolver:U(re),defaultValues:{first_name:"",last_name:"",email:"",phone:"",address:"",delivery_method:c?"delivery":"freight"}}),{control:d,formState:l}=y,T=ee();return u(H,{hf:y,onSubmit:async t=>{var f,o,m;const s={customer:{first_name:t.first_name,last_name:t.last_name,email:t.email,phone:t.phone,address:((f=t.address)==null?void 0:f.trim())||null},total_amount:a,shipping_cost:n,is_home_delivery:t.delivery_method==="delivery",items:r.map(i=>{const A=i.product.discount_price??i.product.original_price;return{product_id:i.product.id,product_name:i.product.name,quantity:i.quantity,unit_price:A,subtotal:A*i.quantity}})};try{const i=await T.mutateAsync(s);p(i)}catch(i){console.error("Error al crear orden:",i),alert(((m=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:m.message)||"Error al procesar la compra")}},children:[e(v,{name:"first_name",control:d,render:({field:t,fieldState:s})=>e(_,{field:t,fieldState:s,formState:l,label:"Nombre",placeholder:"Juan"})}),e(v,{name:"last_name",control:d,render:({field:t,fieldState:s})=>e(_,{field:t,fieldState:s,formState:l,label:"Apellido",placeholder:"Pérez"})}),e(v,{name:"email",control:d,render:({field:t,fieldState:s})=>e(_,{field:t,fieldState:s,formState:l,label:"Email",placeholder:"correo@ejemplo.com"})}),e(v,{name:"phone",control:d,render:({field:t,fieldState:s})=>e(K,{field:t,fieldState:s,formState:l,label:"Teléfono",placeholder:"11 1234-5678"})}),e(v,{name:"address",control:d,render:({field:t,fieldState:s})=>e(_,{field:{...t,value:t.value??"",onChange:f=>t.onChange(f.target.value)},fieldState:s,formState:l,label:"Dirección de envío",placeholder:"Av. Corrientes 1234, Piso 5, Dto A",multiline:!0})}),!c&&e(L,{severity:"info",sx:{mt:2},children:"El costo del flete se coordinará posteriormente con el vendedor."}),u(J,{children:[e(W,{onClick:h,variant:"outlined",color:"inherit",children:"Cancelar"}),e(Q,{children:"Confirmar Compra"})]})]})},ce=()=>{const{cart:r,removeFromCart:a}=j(),[n,c]=b.useState(!1),[p,h]=b.useState(!1),{enqueueSnackbar:y}=B(),d=o=>o.discount_price??o.original_price,l=r.reduce((o,m)=>o+d(m.product)*m.quantity,0),[T,E]=b.useState(l),[t,s]=b.useState(0),f=o=>{y({message:"¡Compra confirmada!",variant:"success"}),r.forEach(m=>a(m.product.id)),c(!1)};return e(g,{sx:{padding:3,maxWidth:1200,margin:"0 auto"},children:u(F,{container:!0,spacing:3,children:[u(F,{item:!0,xs:12,md:8,children:[e(g,{sx:{display:"flex",alignItems:"center",mb:2},children:e(x,{variant:"h6",sx:{ml:1},children:"Carrito"})}),r.length===0?e(x,{children:"El carrito está vacío."}):r.map(o=>u(k,{sx:{mb:2,p:2},children:[e(g,{sx:{display:{xs:"block",md:"none"}},children:e(M,{item:o})}),u(g,{sx:{display:{xs:"none",md:"flex"},alignItems:"center",gap:2},children:[e("img",{src:o.product.images[0].image_url,alt:o.product.name,style:{width:80,height:80,objectFit:"cover",borderRadius:10}}),u(g,{sx:{flex:1},children:[e(x,{variant:"body1",sx:{fontWeight:500,mb:1,textTransform:"none"},children:o.product.name}),e(x,{color:"error",variant:"body2",sx:{cursor:"pointer"},onClick:()=>a(o.product.id),children:"Eliminar"})]}),e(g,{sx:{textAlign:"center",minWidth:120},children:e(x,{variant:"h6",sx:{fontWeight:"bold"},children:O(o.product.discount_price??o.product.original_price)})}),e(g,{sx:{display:"flex",alignItems:"center",gap:1},children:e($,{product:o.product,quantity:o.quantity,size:"small",sx:{bgcolor:"grey.200","&:hover":{bgcolor:"grey.300"}}})})]})]},o.product.id))]}),e(F,{item:!0,xs:12,md:4,children:e(G,{cartProducts:r,totalAmount:l,showCheckoutForm:n,onCheckout:()=>c(!0),isHomeDelivery:p,onIsHomeDeliveryChange:o=>{h(o),c(!1)},onTotalChange:(o,m)=>{E(o),s(m)}})}),n&&u(k,{sx:{mt:3,p:3,maxWidth:"sm"},children:[e(x,{variant:"h6",gutterBottom:!0,children:"Completa tus datos para finalizar la compra"}),e(oe,{cart:r,totalAmount:T,shippingCost:t,isHomeDelivery:p,onSuccess:f,onCancel:()=>c(!1),onResetCheckout:()=>c(!1)})]})]})})};export{ce as default};

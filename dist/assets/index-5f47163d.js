const c={delta:0,timestamp:0},C=1/60*1e3,S=typeof performance<"u"?()=>performance.now():()=>Date.now(),x=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(S()),C);function F(e){let t=[],s=[],i=0,n=!1,r=!1;const a=new WeakSet,d={schedule:(o,h=!1,u=!1)=>{const y=u&&n,g=y?t:s;return h&&a.add(o),g.indexOf(o)===-1&&(g.push(o),y&&n&&(i=t.length)),o},cancel:o=>{const h=s.indexOf(o);h!==-1&&s.splice(h,1),a.delete(o)},process:o=>{if(n){r=!0;return}if(n=!0,[t,s]=[s,t],s.length=0,i=t.length,i)for(let h=0;h<i;h++){const u=t[h];u(o),a.has(u)&&(d.schedule(u),e())}n=!1,r&&(r=!1,d.process(o))}};return d}const V=40;let m=!0,l=!1,v=!1;const f=["read","update","preRender","render","postRender"],p=f.reduce((e,t)=>(e[t]=F(()=>l=!0),e),{}),A=f.reduce((e,t)=>{const s=p[t];return e[t]=(i,n=!1,r=!1)=>(l||b(),s.schedule(i,n,r)),e},{}),P=f.reduce((e,t)=>(e[t]=p[t].cancel,e),{}),U=f.reduce((e,t)=>(e[t]=()=>p[t].process(c),e),{}),R=e=>p[e].process(c),w=e=>{l=!1,c.delta=m?C:Math.max(Math.min(e-c.timestamp,V),1),c.timestamp=e,v=!0,f.forEach(R),v=!1,l&&(m=!1,x(w))},b=()=>{l=!0,m=!0,v||x(w)};function T(e,t){e.indexOf(t)===-1&&e.push(t)}function N(e,t){const s=e.indexOf(t);s>-1&&e.splice(s,1)}class E{constructor(){this.subscriptions=[]}add(t){return T(this.subscriptions,t),()=>N(this.subscriptions,t)}notify(t,s,i){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](t,s,i);else for(let r=0;r<n;r++){const a=this.subscriptions[r];a&&a(t,s,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function D(e,t){return t?e*(1e3/t):0}const M=e=>!isNaN(parseFloat(e));class O{constructor(t,s={}){this.version="7.10.3",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(i,n=!0)=>{this.prev=this.current,this.current=i;const{delta:r,timestamp:a}=c;this.lastUpdated!==a&&(this.timeDelta=r,this.lastUpdated=a,A.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>A.postRender(this.velocityCheck),this.velocityCheck=({timestamp:i})=>{i!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=M(this.current),this.owner=s.owner}onChange(t){return this.on("change",t)}on(t,s){return this.events[t]||(this.events[t]=new E),this.events[t].add(s)}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t){this.passiveEffect=t}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,i){this.set(s),this.prev=t,this.timeDelta=i}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?D(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.stopAnimation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.stopAnimation&&(this.stopAnimation(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.stopAnimation}clearAnimation(){this.stopAnimation=null}destroy(){this.clearListeners(),this.stop()}}function q(e,t){return new O(e,t)}export{E as S,T as a,U as b,P as c,c as f,q as m,N as r,A as s,D as v};

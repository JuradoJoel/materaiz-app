var k=Object.defineProperty;var q=(r,t,n)=>t in r?k(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n;var T=(r,t,n)=>(q(r,typeof t!="symbol"?t+"":t,n),n);import{r as v,m,j as e,aw as A,ax as I,au as w,av as C,$ as P,ah as D,ay as W,U as g,T as x}from"./index-64dae846.js";import{S as j,a as B}from"./CartSummary-ba443fb4.js";import{G as S,C as E,f as L,c as M}from"./CartQuantityControl-f19e5cf7.js";import{G,I as O,u as $,o as z,T as N,C as f,a as b,b as U,c as H}from"./TemplateTextField-cfc2e5ec.js";import{c as R,T as J}from"./TextField-7ee1efa9.js";const Q=({label:r,colSpan:t,placeholder:n,field:u,floatingLabel:p=!1,fieldState:h,...y})=>{var c;const l=v.useId();return m(G,{colSpan:t,children:[p?null:e(R,{htmlFor:l,sx:O,error:!!h.error,children:r}),e(J,{...u,id:l,fullWidth:!0,placeholder:n,type:"number",label:p?r:void 0,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},error:!!h.error,helperText:((c=h.error)==null?void 0:c.message)??"",...y})]})};class V{constructor(){T(this,"keys",{list:()=>["orders","list"]});T(this,"create",async t=>{const{data:n}=await I.post("app/orders",t);return n})}}const Y=new V,K=()=>A({mutationFn:r=>Y.create(r)}),X=w().shape({first_name:C().required("El nombre es obligatorio"),last_name:C().required("El apellido es obligatorio"),email:C().email("Email inválido").required("El email es obligatorio"),phone:C().required("El teléfono es obligatorio").matches(/^[0-9+\-\s()]+$/,"Solo números, espacios, + y guiones").min(10,"Mínimo 10 caracteres"),delivery_method:C().oneOf(["pickup","delivery"]).required("Debe seleccionar un método de entrega"),address:C().when("delivery_method",{is:"delivery",then:r=>r.required("La dirección es obligatoria para envío a domicilio"),otherwise:r=>r.optional().default("")})}),Z=({cart:r,totalAmount:t,shippingCost:n,isHomeDelivery:u,onSuccess:p,onCancel:h})=>{const y=$({resolver:z(X),defaultValues:{first_name:"",last_name:"",email:"",phone:"",address:"",delivery_method:u?"delivery":"pickup"}}),{control:l,formState:c}=y,_=K();return m(N,{hf:y,onSubmit:async a=>{var o,d;const s={customer:{first_name:a.first_name,last_name:a.last_name,email:a.email,phone:a.phone,address:a.delivery_method==="delivery"?a.address:null},total_amount:t,shipping_cost:n,is_home_delivery:a.delivery_method==="delivery",items:r.map(i=>({product_id:i.product.id,product_name:i.product.name,quantity:i.quantity,unit_price:i.product.original_price,subtotal:i.product.original_price*i.quantity}))};try{const i=await _.mutateAsync(s);p(i)}catch(i){console.error("Error al crear orden:",i),alert(((d=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:d.message)||"Error al procesar la compra")}},children:[e(f,{name:"first_name",control:l,render:({field:a,fieldState:s})=>e(b,{field:a,fieldState:s,formState:c,label:"Nombre",placeholder:"Juan"})}),e(f,{name:"last_name",control:l,render:({field:a,fieldState:s})=>e(b,{field:a,fieldState:s,formState:c,label:"Apellido",placeholder:"Pérez"})}),e(f,{name:"email",control:l,render:({field:a,fieldState:s})=>e(b,{field:a,fieldState:s,formState:c,label:"Email",placeholder:"correo@ejemplo.com"})}),e(f,{name:"phone",control:l,render:({field:a,fieldState:s})=>e(Q,{field:a,fieldState:s,formState:c,label:"Teléfono",placeholder:"11 1234-5678"})}),u&&e(f,{name:"address",control:l,render:({field:a,fieldState:s})=>e(b,{field:{...a,value:a.value??"",onChange:o=>a.onChange(o.target.value)},fieldState:s,formState:c,label:"Dirección de envío",placeholder:"Av. Corrientes 1234, Piso 5, Dto A",multiline:!0})}),m(U,{children:[e(P,{onClick:h,variant:"outlined",color:"inherit",children:"Cancelar"}),e(H,{children:"Confirmar Compra"})]})]})},se=()=>{const{cart:r,removeFromCart:t}=D(),[n,u]=v.useState(!1),[p,h]=v.useState(!1),{enqueueSnackbar:y}=W(),l=r.reduce((o,d)=>o+d.product.original_price*d.quantity,0),[c,_]=v.useState(l),[F,a]=v.useState(0),s=o=>{y({message:"¡Compra confirmada!",variant:"success"}),r.forEach(d=>t(d.product.id)),u(!1)};return e(g,{sx:{padding:3,maxWidth:1200,margin:"0 auto"},children:m(S,{container:!0,spacing:3,children:[m(S,{item:!0,xs:12,md:8,children:[e(g,{sx:{display:"flex",alignItems:"center",mb:2},children:e(x,{variant:"h6",sx:{ml:1},children:"Carrito"})}),r.length===0?e(x,{children:"El carrito está vacío."}):r.map(o=>m(E,{sx:{mb:2,p:2},children:[e(g,{sx:{display:{xs:"block",md:"none"}},children:e(j,{item:o})}),m(g,{sx:{display:{xs:"none",md:"flex"},alignItems:"center",gap:2},children:[e("img",{src:o.product.images[0].image_url,alt:o.product.name,style:{width:80,height:80,objectFit:"cover",borderRadius:10}}),m(g,{sx:{flex:1},children:[e(x,{variant:"body1",sx:{fontWeight:500,mb:1,textTransform:"none"},children:o.product.name}),e(x,{color:"error",variant:"body2",sx:{cursor:"pointer"},onClick:()=>t(o.product.id),children:"Eliminar"})]}),e(g,{sx:{textAlign:"center",minWidth:120},children:e(x,{variant:"h6",sx:{fontWeight:"bold"},children:L(o.product.original_price)})}),e(g,{sx:{display:"flex",alignItems:"center",gap:1},children:e(M,{product:o.product,quantity:o.quantity,size:"small",sx:{bgcolor:"grey.200","&:hover":{bgcolor:"grey.300"}}})})]})]},o.product.id))]}),e(S,{item:!0,xs:12,md:4,children:e(B,{cartProducts:r,totalAmount:l,showCheckoutForm:n,onCheckout:()=>u(!0),isHomeDelivery:p,onIsHomeDeliveryChange:h,onTotalChange:(o,d)=>{_(o),a(d)}})}),n&&m(E,{sx:{mt:3,p:3,maxWidth:"sm"},children:[e(x,{variant:"h6",gutterBottom:!0,children:"Completa tus datos para finalizar la compra"}),e(Z,{cart:r,totalAmount:c,shippingCost:F,isHomeDelivery:p,onSuccess:s,onCancel:()=>u(!1)})]})]})})};export{se as default};
